<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSRT</title>
    <style>
        /* Reset and base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        /* Video container */
        .video-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            background: #000;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        /* Video element */
        #videoPlayer {
            width: 100%;
            height: auto;
            display: block;
        }

        /* Hide default video text tracks */
        #videoPlayer::cue {
            display: none;
        }

        /* Custom subtitle overlay */
        .subtitle-overlay {
            position: absolute;
            bottom: 60px;
            left: 0;
            right: 0;
            pointer-events: none;
            z-index: 10;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            padding: 0 20px;
        }

        /* Subtitle text styling */
        .subtitle-text {
            background: rgba(0, 0, 0, 0.8);
            color: #ffffff;
            font-size: 18px;
            font-weight: 500;
            line-height: 1.4;
            padding: 8px 16px;
            border-radius: 4px;
            text-align: center;
            max-width: 80%;
            word-wrap: break-word;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(2px);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .subtitle-text.visible {
            opacity: 1;
        }

        /* Controls */
        .controls {
            background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .controls button {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s ease;
        }

        .controls button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        #progressBar {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            outline: none;
            cursor: pointer;
        }

        #progressBar::-webkit-slider-thumb {
            appearance: none;
            width: 16px;
            height: 16px;
            background: #fff;
            border-radius: 50%;
            cursor: pointer;
        }

        #timeDisplay {
            color: white;
            font-size: 14px;
            min-width: 100px;
            text-align: right;
        }

        /* Fullscreen styles */
        .video-container:-webkit-full-screen {
            width: 100vw;
            height: 100vh;
            max-width: none;
            border-radius: 0;
        }

        .video-container:-moz-full-screen {
            width: 100vw;
            height: 100vh;
            max-width: none;
            border-radius: 0;
        }

        .video-container:fullscreen {
            width: 100vw;
            height: 100vh;
            max-width: none;
            border-radius: 0;
        }

        /* Fullscreen subtitle adjustments */
        .video-container:-webkit-full-screen .subtitle-overlay,
        .video-container:-moz-full-screen .subtitle-overlay,
        .video-container:fullscreen .subtitle-overlay {
            bottom: 80px;
            padding: 0 40px;
        }

        .video-container:-webkit-full-screen .subtitle-text,
        .video-container:-moz-full-screen .subtitle-text,
        .video-container:fullscreen .subtitle-text {
            font-size: 24px;
            padding: 12px 20px;
            max-width: 70%;
        }

        /* Fullscreen controls */
        .video-container:-webkit-full-screen .controls,
        .video-container:-moz-full-screen .controls,
        .video-container:fullscreen .controls {
            padding: 20px 40px;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .subtitle-text {
                font-size: 16px;
                padding: 6px 12px;
                max-width: 90%;
            }

            .subtitle-overlay {
                bottom: 50px;
                padding: 0 15px;
            }

            .controls {
                padding: 10px;
                gap: 8px;
            }

            .controls button {
                padding: 6px 10px;
                font-size: 12px;
            }

            #timeDisplay {
                font-size: 12px;
                min-width: 80px;
            }
        }

        @media (max-width: 480px) {
            .subtitle-text {
                font-size: 14px;
                padding: 4px 8px;
            }

            .subtitle-overlay {
                bottom: 40px;
                padding: 0 10px;
            }
        }

        /* Hide native subtitle tracks */
        video::-webkit-media-text-track-display {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="video-container">
        <video id="videoPlayer" controls crossorigin="anonymous">
            <source src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>

        <!-- Custom subtitle overlay for better control -->
        <div id="subtitleOverlay" class="subtitle-overlay">
            <div id="subtitleText" class="subtitle-text"></div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <button id="playPauseBtn">Play/Pause</button>
            <button id="fullscreenBtn">Fullscreen</button>
            <button id="toggleSubtitles">Toggle Subtitles</button>
            <input type="range" id="progressBar" min="0" max="100" value="0">
            <span id="timeDisplay">0:00 / 0:00</span>
        </div>
    </div>

    <script>
        // Sample subtitle data embedded in JavaScript
        const subtitleData = [
            { start: 0, end: 5, text: "Welcome to the video player with enhanced subtitles!" },
            { start: 5, end: 10, text: "These subtitles are designed to look great and work perfectly in fullscreen mode." },
            { start: 10, end: 15, text: "The text has proper contrast with a semi-transparent background." },
            { start: 15, end: 20, text: "You can toggle subtitles on/off using the button or pressing 'S'." },
            { start: 20, end: 25, text: "Press 'F' to toggle fullscreen mode and see how subtitles adapt." },
            { start: 25, end: 30, text: "Use spacebar to play/pause and arrow keys to skip forward/backward." },
            { start: 30, end: 35, text: "The subtitles maintain their styling and position in all viewing modes." },
            { start: 35, end: 40, text: "This implementation ensures accessibility and great user experience." },
            { start: 40, end: 45, text: "Enjoy your enhanced video viewing experience!" }
        ];

        class VideoPlayer {
            constructor() {
                this.video = document.getElementById('videoPlayer');
                this.subtitleOverlay = document.getElementById('subtitleOverlay');
                this.subtitleText = document.getElementById('subtitleText');
                this.playPauseBtn = document.getElementById('playPauseBtn');
                this.fullscreenBtn = document.getElementById('fullscreenBtn');
                this.toggleSubtitlesBtn = document.getElementById('toggleSubtitles');
                this.progressBar = document.getElementById('progressBar');
                this.timeDisplay = document.getElementById('timeDisplay');
                this.videoContainer = document.querySelector('.video-container');

                this.subtitlesEnabled = true;
                this.subtitleData = subtitleData;

                this.init();
            }

            init() {
                this.setupEventListeners();
            }

            setupEventListeners() {
                // Video events
                this.video.addEventListener('play', () => this.updatePlayPauseButton());
                this.video.addEventListener('pause', () => this.updatePlayPauseButton());
                this.video.addEventListener('timeupdate', () => this.handleTimeUpdate());
                this.video.addEventListener('loadedmetadata', () => this.handleLoadedMetadata());

                // Control events
                this.playPauseBtn.addEventListener('click', () => this.togglePlayPause());
                this.fullscreenBtn.addEventListener('click', () => this.toggleFullscreen());
                this.toggleSubtitlesBtn.addEventListener('click', () => this.toggleSubtitles());
                this.progressBar.addEventListener('input', () => this.handleProgressChange());

                // Fullscreen events
                document.addEventListener('fullscreenchange', () => this.handleFullscreenChange());
                document.addEventListener('webkitfullscreenchange', () => this.handleFullscreenChange());
                document.addEventListener('mozfullscreenchange', () => this.handleFullscreenChange());

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => this.handleKeydown(e));
            }

            displaySubtitles() {
                if (!this.subtitlesEnabled) {
                    this.subtitleText.classList.remove('visible');
                    return;
                }

                const currentTime = this.video.currentTime;
                const currentSubtitle = this.subtitleData.find(sub =>
                    currentTime >= sub.start && currentTime <= sub.end
                );

                if (currentSubtitle) {
                    this.subtitleText.textContent = currentSubtitle.text;
                    this.subtitleText.classList.add('visible');
                } else {
                    this.subtitleText.classList.remove('visible');
                }
            }

            togglePlayPause() {
                if (this.video.paused) {
                    this.video.play();
                } else {
                    this.video.pause();
                }
            }

            updatePlayPauseButton() {
                this.playPauseBtn.textContent = this.video.paused ? 'Play' : 'Pause';
            }

            toggleFullscreen() {
                if (!document.fullscreenElement &&
                    !document.webkitFullscreenElement &&
                    !document.mozFullScreenElement) {
                    this.enterFullscreen();
                } else {
                    this.exitFullscreen();
                }
            }

            enterFullscreen() {
                const container = this.videoContainer;
                if (container.requestFullscreen) {
                    container.requestFullscreen();
                } else if (container.webkitRequestFullscreen) {
                    container.webkitRequestFullscreen();
                } else if (container.mozRequestFullScreen) {
                    container.mozRequestFullScreen();
                }
            }

            exitFullscreen() {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.mozCancelFullScreen) {
                    document.mozCancelFullScreen();
                }
            }

            handleFullscreenChange() {
                const isFullscreen = !!(document.fullscreenElement ||
                                       document.webkitFullscreenElement ||
                                       document.mozFullScreenElement);

                this.fullscreenBtn.textContent = isFullscreen ? 'Exit Fullscreen' : 'Fullscreen';

                // Ensure subtitles remain visible in fullscreen
                if (isFullscreen) {
                    this.subtitleOverlay.style.zIndex = '2147483647'; // Maximum z-index
                } else {
                    this.subtitleOverlay.style.zIndex = '10';
                }
            }

            toggleSubtitles() {
                this.subtitlesEnabled = !this.subtitlesEnabled;
                this.toggleSubtitlesBtn.textContent = this.subtitlesEnabled ? 'Hide Subtitles' : 'Show Subtitles';
                this.displaySubtitles();
            }

            handleTimeUpdate() {
                const progress = (this.video.currentTime / this.video.duration) * 100;
                this.progressBar.value = progress || 0;

                this.updateTimeDisplay();
                this.displaySubtitles();
            }

            handleLoadedMetadata() {
                this.updateTimeDisplay();
                this.progressBar.max = 100;
            }

            handleProgressChange() {
                const time = (this.progressBar.value / 100) * this.video.duration;
                this.video.currentTime = time;
            }

            updateTimeDisplay() {
                const current = this.formatTime(this.video.currentTime || 0);
                const duration = this.formatTime(this.video.duration || 0);
                this.timeDisplay.textContent = `${current} / ${duration}`;
            }

            formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            }

            handleKeydown(e) {
                // Only handle keys when video container is focused or no input is focused
                if (document.activeElement.tagName === 'INPUT') return;

                switch(e.code) {
                    case 'Space':
                        e.preventDefault();
                        this.togglePlayPause();
                        break;
                    case 'KeyF':
                        e.preventDefault();
                        this.toggleFullscreen();
                        break;
                    case 'KeyS':
                        e.preventDefault();
                        this.toggleSubtitles();
                        break;
                    case 'ArrowLeft':
                        e.preventDefault();
                        this.video.currentTime = Math.max(0, this.video.currentTime - 10);
                        break;
                    case 'ArrowRight':
                        e.preventDefault();
                        this.video.currentTime = Math.min(this.video.duration, this.video.currentTime + 10);
                        break;
                }
            }
        }

        // Initialize the video player when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new VideoPlayer();
        });
    </script>
</body>
</html>
